{% extends "base.html" %}

{% block title %}Playlists - Spotify Scraper{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1>Playlists</h1>
        <p class="text-muted">Total: {{ total }} playlists</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Search playlists..." value="{{ search }}">
            <button class="btn btn-primary" type="submit">Search</button>
            {% if search %}
                <a href="/playlists" class="btn btn-secondary">Clear</a>
            {% endif %}
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Owner</th>
                <th>Tracks</th>
                <th>Followers</th>
                <th>Public</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for playlist in playlists %}
            <tr>
                <td>
                    {% if playlist.name %}
                        <strong>{{ playlist.name[:50] }}</strong>
                    {% else %}
                        <em>Unknown</em>
                    {% endif %}
                </td>
                <td>{{ playlist.owner if playlist.owner else 'N/A' }}</td>
                <td>{{ playlist.total_tracks if playlist.total_tracks else 0 }}</td>
                <td>{{ "{:,}".format(playlist.followers) if playlist.followers else 0 }}</td>
                <td>
                    {% if playlist.public %}
                        <span class="badge bg-success">Yes</span>
                    {% else %}
                        <span class="badge bg-secondary">Private</span>
                    {% endif %}
                </td>
                <td>
                    <a href="/playlists/{{ playlist.playlist_id }}" class="btn btn-sm btn-info">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if total == 0 %}
<div class="alert alert-info">No playlists found.</div>
{% else %}
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if page > 1 %}
            <li class="page-item">
                <a class="page-link" href="/playlists?page=1{% if search %}&search={{ search }}{% endif %}">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/playlists?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}">Previous</a>
            </li>
        {% endif %}

        {% for p in range(max(1, page - 2), min(total_pages + 1, page + 3)) %}
            {% if p == page %}
                <li class="page-item active"><span class="page-link">{{ p }}</span></li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="/playlists?page={{ p }}{% if search %}&search={{ search }}{% endif %}">{{ p }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if page < total_pages %}
            <li class="page-item">
                <a class="page-link" href="/playlists?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/playlists?page={{ total_pages }}{% if search %}&search={{ search }}{% endif %}">Last</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}
