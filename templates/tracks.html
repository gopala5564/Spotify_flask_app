{% extends "base.html" %}

{% block title %}Tracks - Spotify Scraper{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1>All Tracks</h1>
        <p class="text-muted">Total: {{ total }} tracks</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" class="input-group">
            <input type="text" name="search" class="form-control" placeholder="Search tracks by name or artist..." value="{{ search }}">
            <button class="btn btn-primary" type="submit">Search</button>
            {% if search %}
                <a href="/tracks" class="btn btn-secondary">Clear</a>
            {% endif %}
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Track Name</th>
                <th>Artist</th>
                <th>Album</th>
                <th>Released</th>
                <th>Popularity</th>
                <th>Explicit</th>
            </tr>
        </thead>
        <tbody>
            {% for track in tracks %}
            <tr>
                <td>
                    <strong>{{ track.name if track.name else "Unknown" }}</strong>
                </td>
                <td>{{ track.artist if track.artist else "Unknown" }}</td>
                <td>{{ track.album if track.album else "Unknown" }}</td>
                <td>{{ track.release_date if track.release_date else "N/A" }}</td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar" role="progressbar" style="width: {{ (track.popularity or 0) }}%">
                            {{ track.popularity or 0 }}
                        </div>
                    </div>
                </td>
                <td>
                    {% if track.explicit %}
                        <span class="badge bg-danger">Explicit</span>
                    {% else %}
                        <span class="badge bg-secondary">Clean</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if total == 0 %}
<div class="alert alert-info">No tracks found.</div>
{% else %}
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if page > 1 %}
            <li class="page-item">
                <a class="page-link" href="/tracks?page=1{% if search %}&search={{ search }}{% endif %}">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/tracks?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}">Previous</a>
            </li>
        {% endif %}

        {% for p in range(max(1, page - 2), min(total_pages + 1, page + 3)) %}
            {% if p == page %}
                <li class="page-item active"><span class="page-link">{{ p }}</span></li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="/tracks?page={{ p }}{% if search %}&search={{ search }}{% endif %}">{{ p }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if page < total_pages %}
            <li class="page-item">
                <a class="page-link" href="/tracks?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/tracks?page={{ total_pages }}{% if search %}&search={{ search }}{% endif %}">Last</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}
